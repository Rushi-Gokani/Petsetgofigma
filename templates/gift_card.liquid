<div class="content-wrapper mx-auto pt-8 text-center">
  <h1 class="heading mb-5 text-2xl text-text-500">{{ 'gift_cards.issued.subtext' | t }}</h1>

  <h2 class="mb-3 text-lg text-primary-500">
    {% if settings.currency_code_enabled %}
      {{ gift_card.balance | money_with_currency }}
    {% else %}
      {{ gift_card.balance | money_without_trailing_zeros }}
    {% endif %}
  </h2>

  {%- if gift_card.enabled == false or gift_card.expired -%}
    <p class="me-2 rounded bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800  ">
      {{ 'gift_cards.issued.expired' | t }}
    </p>
  {%- endif -%}

  {% if gift_card.expires_on %}
    {%- assign gift_card_expiration_date = gift_card.expires_on | date: '%B %e, %Y' -%}
    <p class="me-2 rounded bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800  ">
      {{ 'gift_cards.issued.expiration_date' | t: expires_on: gift_card_expiration_date }}
    </p>
  {% endif %}

  {%- if settings.logo != blank -%}
    {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
    {{ settings.logo | image_url: width: 470 | image_tag: class: 'm-auto', alt: logo_alt }}
  {%- else %}
    <img
      class="m-auto"
      src="{{ 'gift-card/card.svg' | shopify_asset_url }}"
      alt=""
      height="{{ 470 | divided_by: 1.5 }}"
      width="470"
      loading="eager"
    >
  {%- endif %}

  <div
    class="mx-auto mb-7 mt-10 w-40"
    id="gift-card-qr-code"
    data-identifier="{{ gift_card.qr_identifier }}"
  ></div>

  <div x-data="{ copied: false }" class="mb-12">
    <p class="text-base">{{ 'gift_cards.issued.how_to_use_gift_card' | t }}</p>
    <p class="text-lg">{{ gift_card.code | format_code }}</p>

    <template x-if="copied">
      <p class="text-green-700">{{ 'gift_cards.issued.copy_code_success' | t }}</p>
    </template>

    <div class="mx-auto mt-7 flex w-80 flex-col gap-4">
      <button
        type="button"
        class="button button--filled-primary w-full"
        @click="navigator.clipboard.writeText('{{ gift_card.code | format_code }}'); copied = true;"
      >
        {{ 'gift_cards.issued.copy_code' | t }}
      </button>

      <a
        href="{{ shop.url }}"
        class="button button--outline-primary w-full"
        aria-describedby="a11y-new-window-message"
      >
        {{ 'gift_cards.issued.shop_link' | t }}
      </a>

      {%- if gift_card.pass_url -%}
        <a href="{{ gift_card.pass_url }}">
          <img
            src="{{ 'gift-card/add-to-apple-wallet.svg' | shopify_asset_url }}"
            width="120"
            height="40"
            alt="{{ 'gift_cards.issued.add_to_apple_wallet' | t }}"
            loading="lazy"
            class="m-auto"
          >
        </a>
      {%- endif -%}
    </div>
  </div>

  <div hidden>
    <span id="a11y-new-window-message">{{ 'accessibility.link_messages.new_window' | t }}</span>
  </div>
</div>

<script src="{{ 'vendor/qrcode.js' | shopify_asset_url }}" defer></script>
<script>
  var string = { qrImageAlt: {{ 'gift_cards.issued.qr_image_alt' | t | json }} };
  document.addEventListener('DOMContentLoaded', function() {
   new QRCode( document.querySelector('#gift-card-qr-code'), {
    text: document.querySelector('#gift-card-qr-code').dataset.identifier,
    width: 160,
    height: 160,
    imageAltText: string.qrImageAlt
    });
  });
</script>
