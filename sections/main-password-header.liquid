<div class="contents {% if section.settings.custom_color_scheme %}color-{{ section.settings.color_scheme }} bg-bg-500{% endif %}">
  <div
    x-intersect:enter="$store.main.isHeaderShadowVisible = false"
    x-intersect:leave="$store.main.isHeaderShadowVisible = true"
  ></div>

  <header
    class="header {% if section.settings.enable_sticky_header %}sticky{% endif %} end-0 start-0 top-0 z-[36] flex flex-col justify-items-stretch p-3 md:pointer-events-none"
    :style="`opacity: ${$store.main.opacityOnZoom}`"
  >
    <div
      id="header-shadow"
      class="pointer-events-none absolute -top-1 end-0 start-0 -z-10 h-[calc(100%+20px)] -translate-y-full bg-gradient-to-b from-shadow to-transparent transition-all duration-300 ease-linear will-change-transform md:hidden"
      :class="
        {
          'translate-y-0 opacity-100': $store.main.isHeaderShadowVisible,
          '-translate-y-full opacity-0': !$store.main.isHeaderShadowVisible,
        }
      "
    ></div>
    <div
      class="content-wrapper m-auto flex w-full justify-between rounded-md bg-bg-500 py-3 md:justify-end md:bg-transparent md:px-3"
      x-data="{n:0}"
    >
      <div class="col-start-3 flex items-center justify-center md:hidden">
        <a href="{{ routes.root_url }}" x-element-transition-trigger class="rounded-sm px-3 py-2 text-xl font-semibold">
          {% if settings.logo != blank %}
            {%- assign alt = settings.logo.alt | default: shop.name -%}
            {%
              render 'image',
              img_class: 'h-[32px] w-auto',
              src: settings.logo | image_url,
              loading: 'lazy',
              alt: alt,
              is_png: true
            %}
          {% else %}
            {{ shop.name }}
          {% endif %}
        </a>
      </div>

      <div
        class="col-start-5 md:flex md:items-center"
        :class="{'md:drop-shadow-xl': $store.main.isHeaderShadowVisible}"
      >
        {%- capture passwordButton -%}
          {%- form 'storefront_password', class: 'contents', id: 'password-resziable' -%}
            {% liquid
              assign form_errors = false
              if form.errors
                assign form_errors = true
              endif
            %}
            <button
              class="contrast-border md:button--filled-secondary button ghost-primary icon-button icon-button--size-lg"
              x-a11y-trap-element="!$store.resizable.isVisible()"
              @click="!isPasswordFormVisible ? $store.popup.showPopup('password-form') : $store.popup.hidePopup('password-form')"
              type="button"
              aria-label="{{ 'general.password_page.login_password_button' | t }}"
              :class="{
                'hidden': !$store.main.isMobile &&  $store.resizable.isVisible('password-form-desktop'),
              }"
              x-data="
                {
                  isPasswordFormVisible: false,
                }
              "
              x-init="
                $watch('$store.popup.currentPopup', (value) => {
                  isPasswordFormVisible = value === 'password-form';
                })

                $nextTick(() => {
                  if ({{ form_errors }}) {
                    $store.main.isMobile ?  $store.popup.showPopup('password-form') : $store.resizable.show('password-form-desktop')
                  }
                })
              "
            >
              <div class="contents" x-show="!isPasswordFormVisible">
                {% render 'icon-unlock' %}
              </div>
              <div class="contents" x-show="isPasswordFormVisible" style="display:none;">
                {% render 'icon-close' %}
              </div>
            </button>
          {% endform %}
        {%- endcapture -%}

        {% render 'resizable',
          content: passwordButton,
          id: 'password-form-desktop',
          initialWidth: 56,
          initialHeight: 56,
          right: true,
          class: 'resizable--cart md:pointer-events-auto'
        %}
      </div>
    </div>

    <div id="end-of-header"></div>
  </header>

  <div class="pointer-events-none {% if section.settings.enable_sticky_header %}sticky{% else %}static{% endif %} top-[88px] z-30 h-[1px] max-md:hidden">
    <div class="{% if section.settings.enable_sticky_header %}absolute{% else %}relative{% endif %} inset-x-0 -top-[72px] col-start-3 flex min-h-[56px] items-center justify-center text-primary-500">
      <a
        href="{{ routes.root_url }}"
        x-element-transition-trigger
        class="pointer-events-auto rounded-sm px-3 py-2 text-xl font-semibold text-primary-500 transition-all"
        tabindex="3"
        x-a11y-trap-element="$store.transition.isPreviewActive && !$store.resizable.isVisible()"
      >
        {% if settings.logo == blank %}
          {% assign text_length = shop.name | size %}
          {% assign estimated_width = text_length | times: 12 %}
          <svg
            viewBox="0 0 {{ estimated_width }} 25"
            class="m-auto h-[40px] w-2/3"
          >
            <text text-anchor="middle" x="50%" y="20" {% if settings.with_logo_border %}filter="url(#border)"{% endif %}>{{ shop.name }}</text>
          </svg>
        {% else %}
          {%- assign alt = settings.logo.alt | default: shop.name -%}
          {% assign float_logo_width = settings.logo.width | times: 1.0 %}
          {% assign logo_ratio = settings.logo_width | divided_by: float_logo_width %}
          {% assign logo_height = logo_ratio | times: settings.logo.height %}
          <img
            width="{{ settings.logo_width }}"
            height="auto"
            class="max-md:height-[56px] w-auto transition-all"
            alt="{{ alt }}"
            src="{{ settings.logo | image_url }}"
            style="{% if settings.with_logo_border %}filter:url(#border);{% endif %} max-width:{{ settings.logo_width }}px"
            {% if logo_height > 56 %}
              :style="
                {
                  'height': $store.main.isHeaderShadowVisible ? '56px' : '{{ logo_height }}px',
                }
              "
            {% endif %}
          >
        {% endif %}
      </a>
    </div>
  </div>

  {%- capture passwordFormContent -%}
    {%- form 'storefront_password', class: 'contents' -%}
        <div class="rounded-md px-3 py-2 md:w-[400px] md:px-6 md:py-5">
          <div class="relative mb-6 flex items-center overflow-hidden pb-2">
            <h1 class="flex items-center text-md text-text-500 md:text-md" id="popup-label">
              <span class="button__icon me-4 inline-block text-[1.5rem]">
                {% render 'icon-padlock' %}
              </span>
              {{ 'general.password_page.login_form_heading' | t }}
            </h1>
            <button
              type="button"
              class="button button--outline-secondary icon-button icon-button--size-xs absolute end-0 top-0"
              aria-label="{{ 'products.facets.filters_popup.close' | t }}"
              @click="$store.popup.hidePopup('password-form')"
            >
              {% render 'icon-close' %}
            </button>
          </div>

          <div class="flex flex-col items-stretch gap-3 md:gap-4">
            <div>
              <label for="StorePassword" class="sr-only tracking-widest">{{- 'general.password_page.login_form_password_placeholder' | t -}}</label>
              <input
                autocomplete="current-password"
                type="password"
                name="password"
                id="StorePassword"
                class="input__field input__field--outline bg-bg-500 md:px-5 md:py-4 {% if form.errors %}border-error{% endif %}"
                placeholder="{{- 'general.password_page.login_form_password_placeholder' | t -}}"
                {% if form.errors %}
                  aria-invalid="true"
                  aria-describedby="PasswordLoginForm-password-error"
                {%- endif -%}
              >
              {%- if form.errors -%}
                <span class="text-error">{{ 'general.password_page.login_form_error' | t -}}</span>
              {%- endif -%}
            </div>

            <div class="text-sm md:hidden [&_a]:underline">{{ 'general.password_page.admin_link_html' | t }}</div>
            <button type="submit" name="commit" class="button button--filled-primary w-full max-md:mb-3">
              {{ 'general.password_page.login_form_submit' | t }}
            </button>
          </div>
          <div class="mt-3 text-sm max-md:hidden [&_a]:underline">{{ 'general.password_page.admin_link_html' | t }}</div>
        </div>
    {%- endform -%}
  {%- endcapture -%}

  {% render 'popup',
    content: passwordFormContent,
    id: 'password-form',
    isFocused: true,
    desktopTarget: 'password-form-desktop'
  %}
</div>

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "name": {{ shop.name | json }},
    {% if settings.logo %}
      {% assign image_size = settings.logo.width %}
      "logo": {{ settings.logo | image_url: width: image_size | prepend: "https:" | json }},
    {% endif %}
    "sameAs": [
      {{ settings.social_twitter_link | json }},
      {{ settings.social_facebook_link | json }},
      {{ settings.social_pinterest_link | json }},
      {{ settings.social_instagram_link | json }},
      {{ settings.social_tiktok_link | json }},
      {{ settings.social_tumblr_link | json }},
      {{ settings.social_snapchat_link | json }},
      {{ settings.social_youtube_link | json }},
      {{ settings.social_vimeo_link | json }}
    ],
    "url": {{ shop.url | append: page.url | json }}
  }
</script>

{%- if request.page_type == 'index' -%}
  {% assign potential_action_target = shop.url | append: routes.search_url | append: '?q={search_term_string}' %}
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "name": {{ shop.name | json }},
      "potentialAction": {
        "@type": "SearchAction",
        "target": {{ potential_action_target | json }},
        "query-input": "required name=search_term_string"
      },
      "url": {{ shop.url | append: page.url | json }}
    }
  </script>
{%- endif -%}

{% schema %}
{
  "name": "t:sections.header.name",
  "class": "section-header",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_sticky_header",
      "default": true,
      "label": "t:sections.header.settings.enable_sticky_header.label",
      "info": "t:sections.header.settings.enable_sticky_header.info"
    },
    {
      "type": "header",
      "content": "t:sections.all.colors.header"
    },
    {
      "type": "checkbox",
      "id": "custom_color_scheme",
      "default": false,
      "label": "t:sections.all.custom_color_scheme.label",
      "info": "t:sections.all.custom_color_scheme.info"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    }
  ]
}
{% endschema %}
