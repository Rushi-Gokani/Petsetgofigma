<div
  class="{% if section.settings.custom_color_scheme %}color-{{ section.settings.color_scheme }} bg-bg-500{% endif %}"
  style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px"
  x-data="
    {
      slideHeight: 0
    }
  "
>
  <div
    role="region"
    aria-roledescription="{{ 'sections.slideshow.carousel' | t }}"
    aria-label="{{ section.settings.accessibility_info | escape }}"
    x-data="Slider()"
    class="relative"
  >
    {%- capture slides -%}
      {%- for block in section.blocks -%}
        {%- capture slideContent -%}
          <div
            class="relative"
            {% if forloop.index0 == 0 %}
              x-init="() => {
                $nextTick(() => {
                  slideHeight = $el.clientHeight || 0;
                })
              }"
            {% elsif section.settings.slide_height == 'adapt_image' %}
            :style="`${slideHeight ? 'height: ' + slideHeight + 'px' : ''}`"
            {% endif %}
            {{ block.shopify_attributes }}
          >
            <div
              class="absolute start-0 top-0 z-10 h-full w-full bg-black"
              style="opacity: {{ block.settings.image_overlay_opacity | divided_by: 100.0 }}"
            ></div>

            {% liquid
              assign class = 'w-full object-cover object-center'
              if section.settings.slide_height == 'small'
                assign class = class | append: ' h-[40vh]'
              elsif section.settings.slide_height == 'medium'
                assign class = class | append: ' h-[60vh]'
              elsif section.settings.slide_height == 'large'
                assign class = class | append: ' h-[80vh]'
              elsif section.settings.slide_height == 'adapt_image'
                assign class = class | append: ' h-full'
              endif

              assign alt = block.settings.image.alt | default: block.settings.heading
            %}

            {% if block.settings.image %}
              {% render 'image',
                src: block.settings.image,
                img_class: class,
                container_class: 'h-full',
                alt: alt
              %}
            {% else %}
              {%- assign class = class | append: ' bg-secondary-400' -%}
              {{ 'image' | placeholder_svg_tag: class }}
            {% endif %}

            <div class="content-wrapper absolute bottom-0 end-0 start-0 top-0 m-auto">
              <div class="absolute z-20 flex max-w-[500px] flex-col justify-end
                {% case block.settings.box_align %}
                  {% when 'top-left' %}md:top-0 md:start-0
                  {% when 'top-center' %}md:top-0 md:start-1/2 md:-translate-x-1/2 md:rtl:translate-x-1/2
                  {% when 'top-right' %}md:end-0 md:top-0
                  {% when 'middle-left' %}md:top-1/2 md:-translate-y-1/2
                  {% when 'middle-center' %}md:start-1/2 md:top-1/2 md:-translate-x-1/2 md:-translate-y-1/2 md:rtl:translate-x-1/2
                  {% when 'middle-right' %}end-0 top-1/2 -translate-y-1/2
                  {% when 'bottom-left' %}md:bottom-0 md:start-0
                  {% when 'bottom-center' %}md:start-1/2 md:bottom-0 md:-translate-x-1/2 md:rtl:translate-x-1/2
                  {% when 'bottom-right' %}md:bottom-0 md:end-0
                {% endcase %}

                {% case block.settings.text_alignment %}
                  {% when 'left' %}md:items-start md:text-start
                  {% when 'center' %}md:items-center md:text-center
                  {% when 'right' %}md:items-end md:text-end
                {% endcase %}

                {% if block.settings.show_text_box %}
                  bg-bg-500 text-text-500 px-4 md:px-5 py-5 md:py-6 md:p-7 rounded-sm
                {% else %}
                  text-text-on-primary-bg
                {% endif %}
                                  max-md:start-1/2 max-md:top-1/2 max-md:w-[calc(100%-32px)] max-md:-translate-x-1/2 max-md:-translate-y-1/2 max-md:items-center max-md:text-center max-md:rtl:translate-x-1/2
                ">
                <h2 class="heading mb-4 leading-tight text-text-500 md:leading-tight
                  {% case block.settings.heading_size %}
                    {% when 'small' %}text-xl md:text-2xl
                    {% when 'medium' %}text-3xl md:text-4xl
                    {% when 'large' %}text-4xl md:text-6xl
                  {% endcase %}
                  ">
                  {{ block.settings.heading | escape }}
                </h2>
                <div class="mb-4 md:mb-7 [&>p+p]:mt-5">
                  {{ block.settings.subheading }}
                </div>
                {% if block.settings.button_label != blank %}
                  <a
                    {% render '_link-attributes', link: block.settings.link %}
                    class="button {% if block.settings.show_text_box %}button--filled-primary{% else %}button--filled-secondary{% endif %}"
                  >
                    {{ block.settings.button_label }}
                                          <span class="button__icon ms-2">
                        {% render 'icon-circled-arrow-right-top' %}
                      </span>
                  </a>
                {% endif %}
              </div>
            </div>
          </div>
        {%- endcapture -%}

        {%- render 'slider-slide',
          content: slideContent,
          class: 'animate-on-transition relative flex-shrink-0 overflow-hidden'
        -%}

      {%- endfor -%}
    {%- endcapture -%}

    {% liquid
      assign is_auto_play = false
      if section.settings.auto_rotate and section.blocks.size > 1
        assign is_auto_play = true
      endif

      assign autoplay_speed = section.settings.change_slides_speed | times: 1000
    %}

    {%- render 'slider',
      slides: slides,
      gap: 0,
      slides_amount_in_view: '{xs: 1, sm: 1, md: 1, lg: 1, xl: 1, xxl: 1}',
      is_custom_slider_x_data: true,
      is_header_disabled: true,
      is_scrollbar_hidden: true,
      is_auto_play: is_auto_play,
      autoplay_speed: autoplay_speed
    -%}

    <div class="absolute bottom-3 start-1/2 z-20 -translate-x-1/2 md:bottom-5 rtl:translate-x-1/2">
      {% render 'slider-buttons', class: 'bg-bg-500' %}
    </div>
  </div>
</div>

{% comment %} Scroll into slide when block selected {% endcomment %}
{%- if request.design_mode -%}
  <script>
    document.addEventListener('shopify:block:select', function (event) {
      const parentSlideshowComponent = event.target.closest('[x-ref=slider]');

      setTimeout(function () {
        parentSlideshowComponent.scrollTo({
          left: event.target?.parentElement?.offsetLeft,
        });
      }, 200);
    });
  </script>
{% endif %}

{% schema %}
{
  "name": "t:sections.slideshow.name",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "select",
      "id": "slide_height",
      "options": [
        {
          "value": "adapt_image",
          "label": "t:sections.slideshow.settings.slide_height.options__1.label"
        },
        {
          "value": "small",
          "label": "t:sections.slideshow.settings.slide_height.options__2.label"
        },
        {
          "value": "medium",
          "label": "t:sections.slideshow.settings.slide_height.options__3.label"
        },
        {
          "value": "large",
          "label": "t:sections.slideshow.settings.slide_height.options__4.label"
        }
      ],
      "default": "medium",
      "label": "t:sections.slideshow.settings.slide_height.label"
    },
    {
      "type": "checkbox",
      "id": "auto_rotate",
      "label": "t:sections.slideshow.settings.auto_rotate.label",
      "default": false
    },
    {
      "type": "range",
      "id": "change_slides_speed",
      "min": 3,
      "max": 9,
      "step": 2,
      "unit": "s",
      "label": "t:sections.slideshow.settings.change_slides_speed.label",
      "default": 5
    },
    {
      "type": "header",
      "content": "t:sections.slideshow.settings.accessibility.content"
    },
    {
      "type": "text",
      "id": "accessibility_info",
      "label": "t:sections.slideshow.settings.accessibility.label",
      "info": "t:sections.slideshow.settings.accessibility.info",
      "default": "Slideshow about our brand"
    },
    {
      "type": "header",
      "content": "t:sections.all.colors.header"
    },
    {
      "type": "checkbox",
      "id": "custom_color_scheme",
      "default": false,
      "label": "t:sections.all.custom_color_scheme.label",
      "info": "t:sections.all.custom_color_scheme.info"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 52
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "t:sections.slideshow.blocks.slide.name",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.slideshow.blocks.slide.settings.image.label"
        },
        {
          "type": "range",
          "id": "image_overlay_opacity",
          "min": 0,
          "max": 100,
          "step": 10,
          "unit": "%",
          "label": "t:sections.slideshow.blocks.slide.settings.image_overlay_opacity.label",
          "default": 60
        },
        {
          "type": "inline_richtext",
          "id": "heading",
          "default": "Image slide",
          "label": "t:sections.slideshow.blocks.slide.settings.heading.label"
        },
        {
          "type": "select",
          "id": "heading_size",
          "options": [
            {
              "value": "small",
              "label": "t:sections.all.heading_size.options__1.label"
            },
            {
              "value": "medium",
              "label": "t:sections.all.heading_size.options__2.label"
            },
            {
              "value": "large",
              "label": "t:sections.all.heading_size.options__3.label"
            }
          ],
          "default": "medium",
          "label": "t:sections.all.heading_size.label"
        },
        {
          "type": "inline_richtext",
          "id": "subheading",
          "default": "Tell your brand's story through images",
          "label": "t:sections.slideshow.blocks.slide.settings.subheading.label"
        },
        {
          "type": "text",
          "id": "button_label",
          "default": "Button label",
          "label": "t:sections.slideshow.blocks.slide.settings.button_label.label",
          "info": "t:sections.slideshow.blocks.slide.settings.button_label.info"
        },
        {
          "type": "url",
          "id": "link",
          "label": "t:sections.slideshow.blocks.slide.settings.link.label"
        },
        {
          "type": "select",
          "id": "box_align",
          "options": [
            {
              "value": "top-left",
              "label": "t:sections.slideshow.blocks.slide.settings.box_align.options__1.label"
            },
            {
              "value": "top-center",
              "label": "t:sections.slideshow.blocks.slide.settings.box_align.options__2.label"
            },
            {
              "value": "top-right",
              "label": "t:sections.slideshow.blocks.slide.settings.box_align.options__3.label"
            },
            {
              "value": "middle-left",
              "label": "t:sections.slideshow.blocks.slide.settings.box_align.options__4.label"
            },
            {
              "value": "middle-center",
              "label": "t:sections.slideshow.blocks.slide.settings.box_align.options__5.label"
            },
            {
              "value": "middle-right",
              "label": "t:sections.slideshow.blocks.slide.settings.box_align.options__6.label"
            },
            {
              "value": "bottom-left",
              "label": "t:sections.slideshow.blocks.slide.settings.box_align.options__7.label"
            },
            {
              "value": "bottom-center",
              "label": "t:sections.slideshow.blocks.slide.settings.box_align.options__8.label"
            },
            {
              "value": "bottom-right",
              "label": "t:sections.slideshow.blocks.slide.settings.box_align.options__9.label"
            }
          ],
          "default": "middle-center",
          "label": "t:sections.slideshow.blocks.slide.settings.box_align.label",
          "info": "t:sections.slideshow.blocks.slide.settings.box_align.info"
        },
        {
          "type": "checkbox",
          "id": "show_text_box",
          "label": "t:sections.slideshow.blocks.slide.settings.show_text_box.label",
          "default": true
        },
        {
          "type": "select",
          "id": "text_alignment",
          "options": [
            {
              "value": "left",
              "label": "t:sections.slideshow.blocks.slide.settings.text_alignment.option_1.label"
            },
            {
              "value": "center",
              "label": "t:sections.slideshow.blocks.slide.settings.text_alignment.option_2.label"
            },
            {
              "value": "right",
              "label": "t:sections.slideshow.blocks.slide.settings.text_alignment.option_3.label"
            }
          ],
          "default": "center",
          "label": "t:sections.slideshow.blocks.slide.settings.text_alignment.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.slideshow.presets.name",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}
