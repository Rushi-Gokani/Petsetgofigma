<article
  class="{% if section.settings.custom_color_scheme %}color-{{ section.settings.color_scheme }} bg-bg-500{% endif %}"
  itemscope
  itemtype="http://schema.org/BlogPosting"
>
  <div
    class="content-wrapper relative mx-auto"
  >
    {%- for block in section.blocks -%}
      {%- case block.type -%}
        {%- when 'title' -%}
          <header class="mb-7 text-center" {{ block.shopify_attributes }}>
            <div class="mb-4">
              {%- if block.settings.blog_show_date -%}
                <span>{{ article.published_at | date: '%b %d, %Y' }}</span>
              {%- endif -%}

              {% for tag in article.tags %}
                <span class="capitalize before:mx-3 before:inline-block before:text-gray-200 before:content-['/']">
                  {{- tag -}}
                </span>
              {% endfor %}

              {%- if block.settings.blog_show_author -%}
                <span class="capitalize before:mx-3 before:inline-block before:text-gray-200 before:content-['-']">
                  {{ article.author }}
                </span>
              {%- endif -%}
            </div>

            <h1 class="heading text-4xl text-text-500" itemprop="headline">{{ article.title | escape }}</h1>
          </header>

        {%- when 'featured_image' -%}
          {%- if article.image -%}
            <div
              class="
                animate-on-transition mb-7
                {% case block.settings.image_height %}
                  {% when 'small' %}h-[40vh]
                  {% when 'medium' %}h-[60vh]
                  {% when 'large' %}h-[80vh]
                {% endcase %}
              "
              itemprop="image"
              {{ block.shopify_attributes }}
            >
              {%- assign alt = article.image.alt | default: article.title -%}
              {% render 'image',
                img_class: 'h-full w-full object-cover object-center rounded-md',
                container_class: 'h-full w-full ',
                src: article.image,
                width: '100%',
                height: '100%',
                alt: alt
              %}
            </div>
          {% endif %}

        {%- when 'content' -%}
          <div
            class="rte animate-on-transition mb-7"
            itemprop="articleBody"
            {{ block.shopify_attributes }}
          >
            {{ article.content }}
            <div class="clear-both"></div>
          </div>

        {%- when 'share' -%}
          <div class="mb-12 flex justify-end md:mb-16" block.shopify_attributes>
            {% capture share_title %}
            <div class="flex items-center justify-center gap-2 text-start text-base text-primary-500">
              {% render 'icon-share' %}
              <span class="relative ms-2">{{ 'general.share.share_post' | t }}</span>
            </div>
          {% endcapture %}
            {% liquid
              assign url = request.origin | append: article.url
              assign id = section.id | append: '-share'

              render 'share', title: share_title, url: url, id: id
            %}
          </div>
      {%- endcase -%}
    {%- endfor -%}

    {%- if blog.comments_enabled? -%}
      <div class="mb-8 mt-5 md:mb-16 md:mt-8">
        <div id="comments">
          {%- if article.comments_count > 0 -%}
            <h2
              id="comments-{{ article.id }}"
              tabindex="-1"
              class="mb-7 text-2xl"
            >
              {{ 'blogs.article.comments' | t: count: article.comments_count }}
            </h2>
            {% paginate article.comments by 5 %}
              <div class="mb-8">
                <div data-content-wrapper class="flex flex-col gap-y-7">
                  <!-- pagination-content -->
                  {%- for comment in article.comments -%}
                    <article id="{{ comment.id }}" class="">
                      {{ comment.content }}
                      <footer class="mt-4 flex gap-x-3">
                        <span class="text-text-500">{{ comment.author }}</span>
                        <span class="">/</span>
                        <span>
                          {% assign formatted_date = comment.created_at | date: '%B %d, %Y' %}
                          {% assign formatted_time = comment.created_at | date: '%H:%M' %}
                          {{ 'blogs.article.comment_date_time' | t: date: formatted_date, time: formatted_time }}
                        </span>
                      </footer>
                    </article>
                  {%- endfor -%}
                  <!-- end-pagination-content -->
                </div>

                {%- if paginate.pages > 1 and paginate.next -%}
                  <div class="flex flex-col items-center">
                    <a
                      href="#"
                      x-pagination-trigger="{ 'lastPage': {{ paginate.pages }} }"
                      class="button btn--size-md button--outline-primary cursor-pointer"
                    >
                      {{ 'blogs.article.load_more_comments' | t }}
                    </a>
                  </div>
                {%- endif -%}
              </div>
            {% endpaginate %}
          {%- endif -%}
          {% form 'new_comment',
            article,
            class: 'flex flex-col items-center py-7 md:py-8 px-5 md:px-12 rounded-xl bg-secondary-500'
          %}
            {%- liquid
              assign post_message = 'blogs.article.success'
              if blog.moderated? and comment.status == 'unapproved'
                assign post_message = 'blogs.article.success_moderated'
              endif
            -%}
            <h2 class="mb-4 text-2xl text-text-500">{{ 'blogs.article.comment_form_title' | t }}</h2>
            <div
              class="mb-7 text-center text-md "
            >
              {{ 'shopify.online_store.spam_detection.disclaimer_html' | t }}
            </div>
            {%- if form.posted_successfully? -%}
              <div class="mb-7 text-center" role="status">
                <h3 tabindex="-1" autofocus>
                  {% render 'icon-success', class: 'inline' %}
                  {{ post_message | t }}
                </h3>
              </div>
            {%- endif -%}

            <div class="w-full max-w-sm">
              <div class="input {% if form.errors contains 'author' %}input--error{% endif %} mb-3">
                <label for="comment-form-author" class="sr-only tracking-widest">{{ 'blogs.article.name' | t }}</label>
                <input
                  type="text"
                  name="comment[author]"
                  id="comment-form-author"
                  class="input__field input__field--outline bg-bg-500 px-5 py-4"
                  autocomplete="name"
                  value="{{ form.author }}"
                  aria-required="true"
                  {% if form.errors contains 'author' %}
                    aria-invalid="true"
                    aria-describedby="comment-form-author-error"
                  {% endif %}
                  placeholder="{{ 'blogs.article.name' | t }}"
                >
                {%- if form.errors contains 'author' -%}
                  <span
                    id="comment-form-author-error"
                    class="input__message"
                    aria-live="polite"
                  >
                    {{ 'blogs.article.name' | t }}
                    {{ form.errors.messages.author }}
                  </span>
                {%- endif -%}
              </div>
              <div class="input {% if form.errors contains 'email' %}input--error{% endif %} mb-3">
                <label for="comment-form-email" class="sr-only tracking-widest">{{ 'blogs.article.email' | t }}</label>
                <input
                  type="email"
                  name="comment[email]"
                  id="comment-form-email"
                  autocomplete="email"
                  class="input__field input__field--outline bg-bg-500 px-5 py-4"
                  value="{{ form.email }}"
                  autocorrect="off"
                  autocapitalize="off"
                  aria-required="true"
                  {% if form.errors contains 'email' %}
                    aria-invalid="true"
                    aria-describedby="comment-form-email-error"
                  {% endif %}
                  placeholder="{{ 'blogs.article.email' | t }}"
                >
                {%- if form.errors contains 'email' -%}
                  <span
                    id="comment-form-email-error"
                    class="input__message"
                    aria-live="polite"
                  >
                    {{ 'blogs.article.email' | t }}
                    {{ form.errors.messages.email }}
                  </span>
                {%- endif -%}
              </div>
              <div class="input {% if form.errors contains 'body' %}input--error{% endif %} mb-7">
                <label for="comment-form-body" class="sr-only tracking-widest">{{ 'blogs.article.message' | t }}</label>
                <textarea
                  rows="5"
                  name="comment[body]"
                  id="comment-form-body"
                  class="input__field input__field--outline flex h-36 resize-none bg-bg-500 px-5 py-[10px]"
                  aria-required="true"
                  {% if form.errors contains 'body' %}
                    aria-invalid="true"
                    aria-describedby="comment-form-body-error"
                  {% endif %}
                  placeholder="{{ 'blogs.article.message' | t }}"
                >{{ form.body }}</textarea>
                {%- if form.errors contains 'body' -%}
                  <span
                    id="comment-form-body-error"
                    class="input__message"
                    aria-live="polite"
                  >
                    {{ 'blogs.article.message' | t }}
                    {{ form.errors.messages.body }}
                  </span>
                {%- endif -%}
              </div>
              <input type="submit" class="button button--filled-primary w-full" value="{{ 'blogs.article.post' | t }}">
            </div>
          {% endform %}
        </div>
      </div>
    {%- endif -%}
  </div>
</article>

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "articleBody": {{ article.content | strip_html | json }},
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": {{ shop.url | append: page.url | json }}
    },
    "headline": {{ article.title | json }},
    {% if article.excerpt != blank %}
      "description": {{ article.excerpt | strip_html | json }},
    {% endif %}
    {% if article.image %}
      {% assign image_size = article.image.width %}
      "image": [
        {{ article | image_url: width: image_size | prepend: "https:" | json }}
      ],
    {% endif %}
    "datePublished": {{ article.published_at | date: '%Y-%m-%dT%H:%M:%SZ' | json }},
    "dateCreated": {{ article.created_at | date: '%Y-%m-%dT%H:%M:%SZ' | json }},
    "author": {
      "@type": "Person",
      "name": {{ article.author | json }}
    },
    "publisher": {
      "@type": "Organization",
      {% if settings.share_image %}
        {% assign image_size = settings.share_image.width %}
        "logo": {
          "@type": "ImageObject",
          "height": {{ settings.share_image.height | json }},
          "url": {{ settings.share_image | image_url: width: image_size | prepend: "https:" | json }},
          "width": {{ settings.share_image.width | json }}
        },
      {% endif %}
      "name": {{ shop.name | json }}
    }
  }
</script>

{% schema %}
{
  "name": "t:sections.main-article.name",
  "tag": "section",
  "class": "section",
  "blocks": [
    {
      "type": "title",
      "name": "t:sections.main-article.blocks.title.name",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "blog_show_date",
          "default": true,
          "label": "t:sections.main-article.blocks.title.settings.blog_show_date.label"
        },
        {
          "type": "checkbox",
          "id": "blog_show_author",
          "default": false,
          "label": "t:sections.main-article.blocks.title.settings.blog_show_author.label"
        }
      ]
    },
    {
      "type": "featured_image",
      "name": "t:sections.main-article.blocks.featured_image.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "image_height",
          "options": [
            {
              "value": "adapt",
              "label": "t:sections.main-article.blocks.featured_image.settings.image_height.options__1.label"
            },
            {
              "value": "small",
              "label": "t:sections.main-article.blocks.featured_image.settings.image_height.options__2.label"
            },
            {
              "value": "medium",
              "label": "t:sections.main-article.blocks.featured_image.settings.image_height.options__3.label"
            },
            {
              "value": "large",
              "label": "t:sections.main-article.blocks.featured_image.settings.image_height.options__4.label"
            }
          ],
          "default": "small",
          "label": "t:sections.main-article.blocks.featured_image.settings.image_height.label",
          "info": "t:sections.main-article.blocks.featured_image.settings.image_height.info"
        }
      ]
    },
    {
      "type": "content",
      "name": "t:sections.main-article.blocks.content.name",
      "limit": 1
    },
    {
      "type": "share",
      "name": "t:sections.main-article.blocks.share.name",
      "limit": 2,
      "settings": [
        {
          "type": "text",
          "id": "share_label",
          "label": "t:sections.main-article.blocks.share.settings.text.label",
          "default": "Share"
        },
        {
          "type": "paragraph",
          "content": "t:sections.main-article.blocks.share.settings.featured_image_info.content"
        },
        {
          "type": "paragraph",
          "content": "t:sections.main-article.blocks.share.settings.title_info.content"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "header",
      "content": "t:sections.all.colors.header"
    },
    {
      "type": "checkbox",
      "id": "custom_color_scheme",
      "default": false,
      "label": "t:sections.all.custom_color_scheme.label",
      "info": "t:sections.all.custom_color_scheme.info"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    }
  ]
}
{% endschema %}
