{%- liquid
  assign is_full_width = section.settings.is_full_width
  assign background_image = section.settings.background_image
  assign is_expired = false

  assign expiration_date = ''
  assign expiration_date = expiration_date | append: section.settings.expiration_year
  assign expiration_date = expiration_date | append: '-'
  assign expiration_date = expiration_date | append: section.settings.expiration_month
  assign expiration_date = expiration_date | append: '-'
  assign expiration_date = expiration_date | append: section.settings.expiration_day
  assign expiration_date = expiration_date | append: ' '
  assign expiration_date_raw = expiration_date | append: section.settings.expiration_time
  assign expiration_date = expiration_date_raw | date: '%Y-%m-%d %H:%M'

  assign now = 'now' | date: '%Y-%m-%d %H:%M'

  if expiration_date < now and section.settings.is_infinite == false
    assign is_expired = true
  endif

  assign date_start_seconds = expiration_date_raw | date: '%s'
  assign now_date_seconds = now | date: '%s'

  assign date_difference_seconds = date_start_seconds | minus: now_date_seconds

  assign remaining_days = date_difference_seconds | divided_by: 86400
  assign remaining_hours = date_difference_seconds | modulo: 86400 | divided_by: 3600
  assign remaining_minutes = date_difference_seconds | modulo: 3600 | divided_by: 60
  assign remaining_seconds = date_difference_seconds | modulo: 60

  assign show_section = true
  if section.settings.hide_on_complete and is_expired
    assign show_section = false
  endif
-%}

{% if show_section %}
  <div
    class="{% if section.settings.custom_color_scheme %}color-{{ section.settings.color_scheme }} bg-bg-500{% endif %}"
    style="padding-top: {{ section.settings.top_padding }}px; padding-bottom: {{ section.settings.bottom_padding }}px"
    {% unless is_full_width %}
      class="content-wrapper mx-auto"
    {% endunless %}
  >
    <div
      x-data="
        CountdownTimer(
          '{{ expiration_date }}',
          {{ section.settings.is_infinite }},
          {
            days: {{ remaining_days }},
            hours: {{ remaining_hours }},
            minutes: {{ remaining_minutes }},
            seconds: {{ remaining_seconds }}
          }
        )
      "
      x-show="isLoaded {% unless show_section %}&& !isFinished{% endunless %}"
      x-transition
      class="relative bg-secondary-400 {% unless is_full_width %}overflow-hidden rounded-md{% endunless %}"
    >
      {% if background_image %}
        <div
          class="absolute start-0 top-0 z-10 h-full w-full bg-black"
          style="opacity: {{ section.settings.image_overlay_opacity | divided_by: 100.0 }}"
        ></div>
        {%- assign alt = section.settings.image.alt | default: 'banner.image' | t -%}
        {% render 'image',
          img_class: 'absolute start-0 top-0 z-0 h-full w-full object-cover object-center',
          src: background_image,
          width: '100%',
          height: '100%',
          alt: alt
        %}
      {% endif %}

      <div
        class="
          flex w-full items-center
          {% unless is_full_width %}
            content-wrapper mx-auto flex-col md:flex-row md:justify-between md:items-center rounded md:px-12 px-0 w-auto md:w-full
          {% endunless %}
          {% case section.settings.section_height %}
            {% when 'small' %}py-[5vh] h-[40vh]
            {% when 'medium' %}py-[10vh] h-[60vh]
            {% when 'large' %}py-[20vh] h-[80vh]
            {% else %} py-16
          {% endcase %}
        "
      >
        <div
          class="
            relative z-20 mx-auto flex flex-col
            {% if is_full_width %}mx-auto content-wrapper{% endif %}
            {% unless is_full_width %}mx-0 items-start w-full px-5 md:px-0{% endunless %}
          "
        >
          {% for block in section.blocks %}
            {% case block.type %}
              {% when 'heading' %}
                <h1
                  class="heading mb-5 text-2xl md:text-4xl max-md:text-center {% if background_image %}text-bg-50{% else %}text-text-500{% endif %}"
                  {{ block.shopify_attributes }}
                >
                  {{ block.settings.heading }}
                </h1>
              {% when 'text' %}
                <div
                  class="mb-5 max-md:text-center {% if background_image %}text-bg-50{% else %}text-text-500{% endif %}"
                  {{ block.shopify_attributes }}
                >
                  {{ block.settings.text }}
                </div>
              {% when 'timer' %}
                <div
                  class="mb-12 mt-8 {% unless section.settings.is_full_width %}md:ms-auto md:-mt-14{% endunless %}"
                  {{ block.shopify_attributes }}
                >
                  <div class="flex flex-row justify-center gap-6 md:justify-start md:gap-12 {% unless is_full_width %}md:px-14{% endunless %}">
                    <div class="flex flex-col gap-2 text-center">
                      <span
                        x-text="remainingChunk.days"
                        class="min-w-12 text-center text-4xl font-semibold {% if background_image %}text-bg-50{% else %}text-text-500{% endif %}"
                      >
                        0
                      </span>
                      <span class="text-sm font-normal {% if background_image %}text-bg-50{% else %}text-text-500{% endif %}">
                        {{ 'sections.countdown.days' | t }}
                      </span>
                    </div>
                    <div class="h-auto w-[1px] bg-text-700"></div>

                    <div class="flex flex-col gap-2 text-center">
                      <span
                        x-text="remainingChunk.hours"
                        class="min-w-12 text-center text-4xl font-semibold {% if background_image %}text-bg-50{% else %}text-text-500{% endif %}"
                      >
                        0
                      </span>
                      <span class="text-sm font-normal {% if background_image %}text-bg-50{% else %}text-text-500{% endif %}">
                        {{ 'sections.countdown.hours' | t }}
                      </span>
                    </div>
                    <div class="h-auto w-[1px] bg-text-700"></div>

                    <div class="flex flex-col gap-2 text-center">
                      <span
                        x-text="remainingChunk.minutes"
                        class="min-w-12 text-center text-4xl font-semibold {% if background_image %}text-bg-50{% else %}text-text-500{% endif %}"
                      >
                        0
                      </span>
                      <span class="text-sm font-normal {% if background_image %}text-bg-50{% else %}text-text-500{% endif %}">
                        {{ 'sections.countdown.minutes' | t }}
                      </span>
                    </div>
                    <div class="h-auto w-[1px] bg-text-700"></div>

                    <div class="flex flex-col gap-2 text-center">
                      <span
                        x-text="remainingChunk.seconds"
                        class="min-w-12 text-center text-4xl font-semibold {% if background_image %}text-bg-50{% else %}text-text-500{% endif %}"
                      >
                        0
                      </span>
                      <span class="text-sm font-normal {% if background_image %}text-bg-50{% else %}text-text-500{% endif %}">
                        {{ 'sections.countdown.seconds' | t }}
                      </span>
                    </div>
                  </div>
                </div>
              {% when 'button' %}
                {% if block.settings.button_label %}
                  <a
                    {% render '_link-attributes', link: block.settings.button_link %}
                    class="text-center underline md:text-start {% if background_image %}text-bg-50{% else %}text-text-500{% endif %}"
                    {{ block.shopify_attributes }}
                  >
                    {{ block.settings.button_label }}
                    <span class="button__icon ms-2">
                      {% render 'icon-circled-arrow-right-top' %}
                    </span>
                  </a>
                {% endif %}
            {% endcase %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
{% endif %}

{% schema %}
{
  "name": "t:sections.countdown.name",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "t:sections.countdown.settings.bg_image.label"
    },
    {
      "type": "range",
      "id": "image_overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "%",
      "label": "t:sections.countdown.settings.image_overlay_opacity.label",
      "default": 60
    },
    {
      "type": "select",
      "id": "section_height",
      "options": [
        {
          "value": "small",
          "label": "t:sections.countdown.settings.section_height.options__1.label"
        },
        {
          "value": "medium",
          "label": "t:sections.countdown.settings.section_height.options__2.label"
        },
        {
          "value": "large",
          "label": "t:sections.countdown.settings.section_height.options__3.label"
        },
        {
          "value": "fit",
          "label": "t:sections.countdown.settings.section_height.options__4.label"
        }
      ],
      "default": "small",
      "label": "t:sections.countdown.settings.section_height.label",
      "info": "t:sections.countdown.settings.section_height.info"
    },
    {
      "type": "checkbox",
      "id": "is_full_width",
      "label": "t:sections.countdown.settings.is_full_width.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.countdown.settings.header.content"
    },
    {
      "type": "select",
      "id": "expiration_year",
      "label": "t:sections.countdown.settings.year.label",
      "options": [
        {
          "value": "2024",
          "label": "2024"
        },
        {
          "value": "2025",
          "label": "2025"
        },
        {
          "value": "2026",
          "label": "2026"
        },
        {
          "value": "2027",
          "label": "2027"
        },
        {
          "value": "2028",
          "label": "2028"
        },
        {
          "value": "2029",
          "label": "2029"
        },
        {
          "value": "2030",
          "label": "2030"
        },
        {
          "value": "2031",
          "label": "2031"
        },
        {
          "value": "2032",
          "label": "2032"
        },
        {
          "value": "2033",
          "label": "2033"
        },
        {
          "value": "2034",
          "label": "2034"
        },
        {
          "value": "2035",
          "label": "2035"
        },
        {
          "value": "2036",
          "label": "2036"
        },
        {
          "value": "2037",
          "label": "2037"
        },
        {
          "value": "2038",
          "label": "2038"
        },
        {
          "value": "2039",
          "label": "2039"
        },
        {
          "value": "2040",
          "label": "2040"
        }
      ],
      "default": "2024"
    },
    {
      "type": "select",
      "id": "expiration_month",
      "label": "t:sections.countdown.settings.month.label",
      "options": [
        {
          "value": "1",
          "label": "t:sections.countdown.settings.month.options.january"
        },
        {
          "value": "2",
          "label": "t:sections.countdown.settings.month.options.february"
        },
        {
          "value": "3",
          "label": "t:sections.countdown.settings.month.options.march"
        },
        {
          "value": "4",
          "label": "t:sections.countdown.settings.month.options.april"
        },
        {
          "value": "5",
          "label": "t:sections.countdown.settings.month.options.may"
        },
        {
          "value": "6",
          "label": "t:sections.countdown.settings.month.options.june"
        },
        {
          "value": "7",
          "label": "t:sections.countdown.settings.month.options.july"
        },
        {
          "value": "8",
          "label": "t:sections.countdown.settings.month.options.august"
        },
        {
          "value": "9",
          "label": "t:sections.countdown.settings.month.options.september"
        },
        {
          "value": "10",
          "label": "t:sections.countdown.settings.month.options.october"
        },
        {
          "value": "11",
          "label": "t:sections.countdown.settings.month.options.november"
        },
        {
          "value": "12",
          "label": "t:sections.countdown.settings.month.options.december"
        }
      ],
      "default": "1"
    },
    {
      "type": "select",
      "id": "expiration_day",
      "label": "t:sections.countdown.settings.day.label",
      "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        },
        {
          "value": "3",
          "label": "3"
        },
        {
          "value": "4",
          "label": "4"
        },
        {
          "value": "5",
          "label": "5"
        },
        {
          "value": "6",
          "label": "6"
        },
        {
          "value": "7",
          "label": "7"
        },
        {
          "value": "8",
          "label": "8"
        },
        {
          "value": "9",
          "label": "9"
        },
        {
          "value": "10",
          "label": "10"
        },
        {
          "value": "11",
          "label": "11"
        },
        {
          "value": "12",
          "label": "12"
        },
        {
          "value": "13",
          "label": "13"
        },
        {
          "value": "14",
          "label": "14"
        },
        {
          "value": "15",
          "label": "15"
        },
        {
          "value": "16",
          "label": "16"
        },
        {
          "value": "17",
          "label": "17"
        },
        {
          "value": "18",
          "label": "18"
        },
        {
          "value": "19",
          "label": "19"
        },
        {
          "value": "20",
          "label": "20"
        },
        {
          "value": "21",
          "label": "21"
        },
        {
          "value": "22",
          "label": "22"
        },
        {
          "value": "23",
          "label": "23"
        },
        {
          "value": "24",
          "label": "24"
        },
        {
          "value": "25",
          "label": "25"
        },
        {
          "value": "26",
          "label": "26"
        },
        {
          "value": "27",
          "label": "27"
        },
        {
          "value": "28",
          "label": "28"
        },
        {
          "value": "29",
          "label": "29"
        },
        {
          "value": "30",
          "label": "30"
        },
        {
          "value": "31",
          "label": "31"
        }
      ],
      "default": "1"
    },
    {
      "type": "select",
      "id": "expiration_time",
      "label": "t:sections.countdown.settings.time.label",
      "options": [
        {
          "value": "00:00",
          "label": "12:00 AM"
        },
        {
          "value": "00:30",
          "label": "12:30 AM"
        },
        {
          "value": "01:00",
          "label": "1:00 AM"
        },
        {
          "value": "01:30",
          "label": "1:30 AM"
        },
        {
          "value": "02:00",
          "label": "2:00 AM"
        },
        {
          "value": "02:30",
          "label": "2:30 AM"
        },
        {
          "value": "03:00",
          "label": "3:00 AM"
        },
        {
          "value": "03:30",
          "label": "3:30 AM"
        },
        {
          "value": "04:00",
          "label": "4:00 AM"
        },
        {
          "value": "04:30",
          "label": "4:30 AM"
        },
        {
          "value": "05:00",
          "label": "5:00 AM"
        },
        {
          "value": "05:30",
          "label": "5:30 AM"
        },
        {
          "value": "06:00",
          "label": "6:00 AM"
        },
        {
          "value": "06:30",
          "label": "6:30 AM"
        },
        {
          "value": "07:00",
          "label": "7:00 AM"
        },
        {
          "value": "07:30",
          "label": "7:30 AM"
        },
        {
          "value": "08:00",
          "label": "8:00 AM"
        },
        {
          "value": "08:30",
          "label": "8:30 AM"
        },
        {
          "value": "09:00",
          "label": "9:00 AM"
        },
        {
          "value": "09:30",
          "label": "9:30 AM"
        },
        {
          "value": "10:00",
          "label": "10:00 AM"
        },
        {
          "value": "10:30",
          "label": "10:30 AM"
        },
        {
          "value": "11:00",
          "label": "11:00 AM"
        },
        {
          "value": "11:30",
          "label": "11:30 AM"
        },
        {
          "value": "12:00",
          "label": "12:00 PM"
        },
        {
          "value": "12:30",
          "label": "12:30 PM"
        },
        {
          "value": "13:00",
          "label": "1:00 PM"
        },
        {
          "value": "13:30",
          "label": "1:30 PM"
        },
        {
          "value": "14:00",
          "label": "2:00 PM"
        },
        {
          "value": "14:30",
          "label": "2:30 PM"
        },
        {
          "value": "15:00",
          "label": "3:00 PM"
        },
        {
          "value": "15:30",
          "label": "3:30 PM"
        },
        {
          "value": "16:00",
          "label": "4:00 PM"
        },
        {
          "value": "16:30",
          "label": "4:30 PM"
        },
        {
          "value": "17:00",
          "label": "5:00 PM"
        },
        {
          "value": "17:30",
          "label": "5:30 PM"
        },
        {
          "value": "18:00",
          "label": "6:00 PM"
        },
        {
          "value": "18:30",
          "label": "6:30 PM"
        },
        {
          "value": "19:00",
          "label": "7:00 PM"
        },
        {
          "value": "19:30",
          "label": "7:30 PM"
        },
        {
          "value": "20:00",
          "label": "8:00 PM"
        },
        {
          "value": "20:30",
          "label": "8:30 PM"
        },
        {
          "value": "21:00",
          "label": "9:00 PM"
        },
        {
          "value": "21:30",
          "label": "9:30 PM"
        },
        {
          "value": "22:00",
          "label": "10:00 PM"
        },
        {
          "value": "22:30",
          "label": "10:30 PM"
        },
        {
          "value": "23:00",
          "label": "11:00 PM"
        },
        {
          "value": "23:30",
          "label": "11:30 PM"
        }
      ],
      "default": "03:00"
    },
    {
      "type": "checkbox",
      "id": "is_infinite",
      "label": "t:sections.countdown.settings.is_infinite.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "hide_on_complete",
      "label": "t:sections.countdown.settings.hide_on_complete.label",
      "default": false
    },
    {
      "type": "header",
      "content": "t:sections.all.colors.header"
    },
    {
      "type": "checkbox",
      "id": "custom_color_scheme",
      "default": false,
      "label": "t:sections.all.custom_color_scheme.label",
      "info": "t:sections.all.custom_color_scheme.info"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "top_padding",
      "min": 0,
      "max": 500,
      "step": 5,
      "unit": "px",
      "label": "Top padding",
      "default": 65
    },
    {
      "type": "range",
      "id": "bottom_padding",
      "min": 0,
      "max": 500,
      "step": 5,
      "unit": "px",
      "label": "Bottom padding",
      "default": 65
    }
  ],
  "blocks": [
    {
      "type": "heading",
      "name": "t:sections.countdown.blocks.heading.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "default": "Countdown title",
          "label": "t:sections.countdown.blocks.heading.settings.heading.label"
        }
      ]
    },
    {
      "type": "text",
      "name": "t:sections.countdown.blocks.text.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "text",
          "default": "Get XX% off before xx-xx-xx!",
          "label": "t:sections.countdown.blocks.text.settings.text.label"
        }
      ]
    },
    {
      "type": "timer",
      "name": "t:sections.countdown.blocks.timer.name",
      "limit": 1
    },
    {
      "type": "button",
      "name": "t:sections.countdown.blocks.buttons.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "button_label",
          "default": "Button label",
          "label": "t:sections.countdown.blocks.buttons.settings.button_label.label",
          "info": "t:sections.countdown.blocks.buttons.settings.button_label.info"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "t:sections.countdown.blocks.buttons.settings.button_link.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Countdown (timer)",
      "category": "Text",
      "blocks": [
        {
          "type": "heading"
        },
        {
          "type": "text"
        },
        {
          "type": "timer"
        },
        {
          "type": "button"
        }
      ]
    }
  ]
}
{% endschema %}
