{% style %}
  .bg-white {
    background-color: #ffffff !important;
  }
  .bg-transparent {
    background-color: transparent !important;
  }
{% endstyle %}

<div class="contents">
  <div
    x-intersect:enter="$store.main.isHeaderShadowVisible = false"
    x-intersect:leave="$store.main.isHeaderShadowVisible = true"
  ></div>

  <header
    x-data="
      {
        isMenuVisible: false,
        isCartVisible: false,
      }
    "
    x-init="
      $watch('$store.popup.currentPopup', (value) => {
        isMenuVisible = value === 'menu';
        isCartVisible = value === 'cart';
      })
    "
    class="header {% if section.settings.enable_transparent_header and request.page_type == 'index' %}bg-transparent{% elsif section.settings.custom_color_scheme %}color-{{ section.settings.color_scheme }}{% else %}bg-white{% endif %} {% if section.settings.enable_sticky_header %}sticky{% endif %} end-0 start-0 top-0 z-[36] flex flex-col justify-items-stretch p-3 md:pointer-events-none"
    :style="`opacity: ${$store.main.opacityOnZoom}; --menu-width: {{ section.settings.menu_width }}px;`"
  >
    <div
      id="header-shadow"
      class="pointer-events-none absolute -top-1 end-0 start-0 -z-10 h-[calc(100%+20px)] -translate-y-full bg-gradient-to-b from-shadow to-transparent transition-all duration-300 ease-linear will-change-transform md:hidden"
      :class="
        {
          'translate-y-0 opacity-100': $store.main.isHeaderShadowVisible,
          '-translate-y-full opacity-0': !$store.main.isHeaderShadowVisible,
        }
      "
    ></div>
    <div
      class="content-wrapper col-start-1 m-auto grid w-full grid-cols-header items-center bg-white rounded-md py-3 md:flex md:bg-white md:px-3 relative"
      x-data="{n:0}"
    >
      <div class="transition-all md:flex">
        {%- capture menu -%}
          <button
            x-data
            x-a11y-trap-element="$store.transition.isPreviewActive && !$store.resizable.isVisible()"
            @click="!isMenuVisible ? $store.popup.showPopup('menu', true) : $store.popup.hidePopup('menu')"
            type="button"
            aria-label="{{ 'sections.header.open_menu' | t }}"
            :aria-controls="$store.main.isMobile ? 'menu' : 'menu-desktop'"
            :aria-expanded="$store.main.isMobile ? $store.popup.currentPopup === 'menu' : $store.resizable.isVisible('menu-desktop')"
            class="mobile_menu_opener flex items-center gap-2 border border-[#F5A623] rounded-[5px] px-6 py-2 text-black font-medium hover:bg-gray-50 transition-colors"
            style="border: 1px solid #F5A623; border-radius: 5px;"
            tabindex="2"
          >
            <div
              class="contents block text-[#F5A623]"
              :class="{
                'invisible': isMenuVisible,
              }"
              x-show="!isMenuVisible"
            >
              {% render 'icon-menu' %}
            </div>
            <div
              class="contents block"
              :class="{
                'invisible': !isMenuVisible,
              }"
              x-show="isMenuVisible"
              style="display:none;"
            >
              {% render 'icon-close' %}
            </div>
            <span class="text-md font-semibold text-black">{{ 'sections.header.menu' | t }}</span>
          </button>
        {%- endcapture -%}
        {% render 'resizable',
          content: menu,
          id: 'menu-desktop',
          initialWidth: 105,
          initialHeight: 56,
          class: 'resizable--menu md:pointer-events-auto relative z-30'
        %}
      </div>
      <div class="col-start-3 flex items-center justify-center md:hidden">
        <a href="{{ routes.root_url }}" x-element-transition-trigger class="rounded-sm px-3 py-2 text-xl font-semibold">
          {% if settings.logo != blank %}
            {%- assign alt = settings.logo.alt | default: shop.name -%}
            {%
              render 'image',
              img_class: 'h-[32px] w-auto',
              src: settings.logo | image_url,
              loading: 'lazy',
              alt: alt,
              is_png: true
            %}
          {% else %}
            {{ shop.name }}
          {% endif %}
        </a>
      </div>
      
      <div class="col-start-3 hidden md:flex items-center justify-center md:absolute md:left-1/2 md:-translate-x-1/2 z-20" style="position: absolute; left: 50%; transform: translateX(-50%); z-index: 20;">
          <a
            href="{{ routes.root_url }}"
            x-element-transition-trigger
            class="heading pointer-events-auto rounded-sm px-3 py-2 text-xl text-primary-500 transition-all"
            tabindex="3"
            x-a11y-trap-element="$store.transition.isPreviewActive && !$store.resizable.isVisible()"
            aria-label="{{ shop.name }}"
          >
            {% if settings.logo == blank %}
              {% assign text_length = shop.name | size %}
              {% assign estimated_width = text_length | times: 13 %}
              <svg
                viewBox="0 0 {{ estimated_width }} 25"
                class="m-auto h-[40px] w-2/3"
              >
                <text
                  text-anchor="middle"
                  x="50%"
                  y="20"
                  {% if settings.with_logo_border %}
                    filter="url(#border)"
                  {% endif %}
                >{{ shop.name }}</text>
              </svg>
            {% else %}
              {%- assign alt = settings.logo.alt | default: shop.name -%}
              {% assign float_logo_width = settings.logo.width | times: 1.0 %}
              {% assign logo_ratio = settings.logo_width | divided_by: float_logo_width %}
              {% assign logo_height = logo_ratio | times: settings.logo.height %}
              <img
                width="{{ settings.logo_width }}"
                height="auto"
                class="max-md:height-[56px] w-auto transition-all"
                alt="{{ alt }}"
                src="{{ settings.logo | image_url }}"
                style="{% if settings.with_logo_border %}filter:url(#border);{% endif %} max-width:{{ settings.logo_width }}px"
                {% if logo_height > 56 %}
                  :style="
                    {
                      'height': $store.main.isHeaderShadowVisible ? '56px' : '{{ logo_height }}px',
                    }
                  "
                {% endif %}
              >
            {% endif %}
          </a>
      </div>
      <div class="contents md:flex md:flex-grow md:justify-end">
        <div
          class="col-start-5 transition-all md:flex md:items-center gap-2"
        >
          <!-- Desktop Search Form -->
          <form action="{{ routes.search_url }}" method="get" role="search" class="hidden md:flex items-center justify-between w-[400px] min-w-[400px] border border-gray-200 rounded-full px-4 py-3 hover:border-gray-300 transition-colors shrink-0 pointer-events-auto" style="width: 400px; min-width: 400px; border-radius: 9999px;">
            <input
              type="search"
              name="q"
              value="{{ search.terms | escape }}"
              placeholder="Search here"
              class="w-full bg-transparent border-none focus:ring-0 text-sm text-gray-700 placeholder-gray-500 outline-none"
              aria-label="{{ 'general.search.placeholder' | t }}"
            >
            <button type="submit" class="text-gray-500 hover:text-black">
              {% render 'icon-search', class: 'w-4 h-4' %}
            </button>
          </form>



          {%- capture account -%}
          <button
            tabindex="0"
            class="contrast-border md:button--filled-secondary button button--ghost-primary icon-button icon-button--size-lg text-black account-button-header relative"
            style="color: black;"
            aria-label="{{ 'customer.account_fallback' | t }}"
            @keydown.space.prevent="$store.resizable.show('account-desktop')" @keydown.enter.prevent="$store.resizable.show('account-desktop')"
            x-a11y-trap-element="$store.transition.isPreviewActive && !$store.resizable.isVisible()">
            {% if customer %}
              <div class="account-initials-button">
                {{ customer.first_name | slice: 0 | upcase }}{{ customer.last_name | slice: 0 | upcase }}
              </div>
            {% else %}
              {% render 'icon-account' %}
            {% endif %}
          </button>
          {%- endcapture -%}
          {% render 'resizable',
            content: account,
            id: 'account-desktop',
            initialWidth: 56,
            initialHeight: 56,
            right: true,
            isNotScrollable: true,
            class: 'resizable--account max-md:hidden md:pointer-events-auto'
          %}


          {%- capture cart -%}
            <a
              x-init="
                if (!$store.cart.isCartInitialized) {
                  $store.cart.setCartItems({{ cart.items | json | escape }});
                  $store.cart.isCartInitialized = true;
                }
              "
              class="contrast-border md:button--filled-secondary button button--ghost-primary icon-button icon-button--size-lg text-black col-start-5 relative"
              style="color: black;"
              x-a11y-trap-element="$store.transition.isPreviewActive && !$store.resizable.isVisible()"
              href="{{ routes.cart_url }}"
              {% if settings.cart_type == 'page' %}
                x-element-transition-trigger
              {% else %}
                @click.prevent.stop="!isCartVisible ? $store.cart.showCart() : $store.cart.hideCart()"
              {% endif %}
              aria-label="{{ 'general.cart.view_shopping_cart' | t }}"
              :class="{'hidden': !$store.main.isMobile &&   $store.resizable.isVisible('cart-desktop')}"
            >
              <div
                class="contents"
                :class="{
                  'invisible': isCartVisible,
                }"
                x-show="!isCartVisible"
              >
                {% assign cartQty = cart.item_count | default: 0 %}
                <span
                  {% if cartQty != 0 %}
                    style="display: none"
                  {% endif %}
                  x-show="$store.main.totalCartQty === 0"
                >
                  {%- render 'icon-cart-empty' -%}
                </span>
                <span
                  {% if cartQty != 1 %}
                    style="display: none"
                  {% endif %}
                  x-show="$store.main.totalCartQty === 1"
                >
                  {%- render 'icon-cart' -%}
                </span>
                <span
                  {% if cartQty < 2 %}
                    style="display: none"
                  {% endif %}
                  x-show="$store.main.totalCartQty > 1"
                  class="-scale-x-100"
                >
                  {%- render 'icon-carts' -%}
                </span>
              </div>
              <div
                class="contents"
                :class="{
                  'invisible': !isCartVisible,
                }"
                x-show="isCartVisible"
                style="display:none;"
              >
                {% render 'icon-close' %}
              </div>
              {% assign cartQty = cart.item_count | default: 0 %}
              <span 
                class="cart-count-badge"
                {% if cartQty == 0 %}
                  style="display: none"
                {% endif %}
                x-show="$store.main.totalCartQty > 0"
                x-text="$store.main.totalCartQty"
              >{{ cartQty }}</span>
            </a>
            {%- endcapture -%}

          {% render 'resizable',
            content: cart,
            id: 'cart-desktop',
            initialWidth: 56,
            initialHeight: 56,
            right: true,
            class: 'resizable--cart md:pointer-events-auto'
          %}
        </div>
      </div>
    </div>
    <div id="end-of-header"></div>
  </header>



  {% comment %}
    <ul class="header__menu-nav hidden md:flex">
      {% for link in section.settings.menu.links %}
        {% if link.links != blank %}
          <li class="nav__item py-5 px-4 block relative">
            <a href="{{ link.url }}">{{ link.title }}</a>
            <ul class="nav__item-submenu absolute bg-bg-500 border py-3 px-4 min-w-[160px] top-16 start-1/2 transform -translate-x-1/2">
              {% for sublink in linklists[link.handle].links %}
                <li>
                  <a class="block py-1 hover:opacity-75 " href="{{ sublink.url }}">
                    {{ sublink.title }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          </li>
        {% else %}
          <li>
            <a class="nav__item py-5 px-4 block" href="{{ link.url }}"> {{ link.title }}</a>
          </li>
        {% endif %}
      {% endfor %}

      <div
          class="header__icons flex items-center justify-end space-x-5"
          x-data="{ cart_count: {{ cart.item_count }} }"
          @cart-count-updated.window="cart_count = $event.detail"
        >
          {%- if shop.customer_accounts_enabled -%}
            <div class="relative account-menu-wrapper z-10">
              <a
                href="{{ routes.account_url }}"
                title="account link"
                class="header__icon block text-center"
              >
                {% render 'icon-account', class: 'w-10 mx-auto' %}
                <span class="sr-only">
                  {%- liquid
                    if customer
                      echo 'customer.account_fallback' | t
                    else
                      echo 'customer.account_fallback' | t
                    endif
                  -%}
                </span>
              </a>
            </div>
          {%- endif -%}

          <button
            type="button"
            title="Cart button"
            @click="$dispatch('toggle-cart')"
            class="header__icon text-center relative"
          >
            {% render 'icon-cart', class: 'w-10' %}
            <span class="sr-only">{{ 'templates.cart.cart' | t }}</span>
            <span
              x-text="cart_count"
              class="cart__count min-w-[22px] text-sm min-h-[22px] absolute grid place-content-center rounded-full -top-3 -end-1 text-secondary-500 bg-black"
            >
              {{ cart.item_count }}
            </span>
          </button>
        </div>
  {% endcomment %}

  {% render 'menu' %}
  <div id="mini-cart" class="contents">
    <!-- mini-cart -->
    {% render 'minicart' %}
    <!-- end-mini-cart -->
  </div>
</div>

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "name": {{ shop.name | json }},
    {% if settings.logo %}
      {% assign image_size = settings.logo.width %}
      "logo": {{ settings.logo | image_url: width: image_size | prepend: "https:" | json }},
    {% endif %}
    "sameAs": [
      {{ settings.social_twitter_link | json }},
      {{ settings.social_facebook_link | json }},
      {{ settings.social_pinterest_link | json }},
      {{ settings.social_instagram_link | json }},
      {{ settings.social_tiktok_link | json }},
      {{ settings.social_tumblr_link | json }},
      {{ settings.social_snapchat_link | json }},
      {{ settings.social_youtube_link | json }},
      {{ settings.social_vimeo_link | json }}
    ],
    "url": {{ shop.url | append: page.url | json }}
  }
</script>

{%- if request.page_type == 'index' -%}
  {% assign potential_action_target = shop.url | append: routes.search_url | append: '?q={search_term_string}' %}
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "name": {{ shop.name | json }},
      "potentialAction": {
        "@type": "SearchAction",
        "target": {{ potential_action_target | json }},
        "query-input": "required name=search_term_string"
      },
      "url": {{ shop.url | append: page.url | json }}
    }
  </script>
{%- endif -%}

{% schema %}
{
  "name": "t:sections.header.name",
  "class": "section-header",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "t:sections.header.settings.menu.label"
    },
    {
      "type": "range",
      "id": "menu_width",
      "label": "t:sections.header.settings.menu_width.label",
      "default": 250,
      "min": 150,
      "max": 350,
      "step": 5
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_header",
      "default": true,
      "label": "t:sections.header.settings.enable_sticky_header.label",
      "info": "t:sections.header.settings.enable_sticky_header.info"
    },
    {
      "type": "header",
      "content": "t:sections.all.colors.header"
    },
    {
      "type": "checkbox",
      "id": "custom_color_scheme",
      "default": false,
      "label": "t:sections.all.custom_color_scheme.label",
      "info": "t:sections.all.custom_color_scheme.info"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Transparent Background"
    },
    {
      "type": "checkbox",
      "id": "enable_transparent_header",
      "default": false,
      "label": "Enable transparent header",
      "info": "Makes the header background transparent on homepage"
    }
  ]
}
{% endschema %}
