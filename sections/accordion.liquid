{% liquid
  assign top_padding = section.settings.padding_top | round: 0
  assign bottom_padding = section.settings.padding_bottom | round: 0
%}

<section
  id="{{ section.id }}"
  class="accordion-section {% if section.settings.custom_color_scheme %}color-{{ section.settings.color_scheme }}{% endif %}"
  style="padding-top: {{ top_padding }}px; padding-bottom: {{ bottom_padding }}px;"
  x-data="AccordionGroup()"
>
  <div class="content-wrapper mx-auto">
    {% if section.settings.heading != blank %}
      <div class="text-center mb-8">
        <h2 class="section-title text-2xl md:text-4xl font-bold text-text-500">
          {{ section.settings.heading | escape }}
        </h2>
        {% if section.settings.subheading != blank %}
          <p class="section-subtitle mt-4 text-lg text-text-400">
            {{ section.settings.subheading | escape }}
          </p>
        {% endif %}
      </div>
    {% endif %}

    <div class="accordion-container flex flex-col md:flex-row gap-4 md:gap-6">
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'accordion_item' %}
            <div
              class="accordion-item flex-1"
              x-data="{ isActive: {% if forloop.index == 1 %}true{% else %}false{% endif %} }"
              {{ block.shopify_attributes }}
            >
              <!-- Accordion Header -->
              <button
                class="accordion-header w-full text-left focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-lg"
                @click="toggleAccordion({{ forloop.index0 }})"
                :class="{ 'active': isActive }"
                type="button"
                :aria-expanded="isActive"
                aria-controls="accordion-content-{{ block.id }}"
              >
                <div class="accordion-header-content p-4 md:p-6 bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-all duration-300">
                  {% if block.settings.image != blank %}
                    <div class="accordion-image mb-4">
                      {% render 'image',
                        src: block.settings.image,
                        alt: block.settings.image.alt,
                        img_class: 'w-full h-48 md:h-32 object-cover rounded-lg',
                        container_class: 'overflow-hidden rounded-lg'
                      %}
                    </div>
                  {% endif %}
                  
                  <div class="flex items-center justify-between">
                    <h3 class="accordion-title text-lg md:text-xl font-semibold text-text-500">
                      {{ block.settings.title | escape }}
                    </h3>
                    <div class="accordion-icon ml-4 transform transition-transform duration-300" :class="{ 'rotate-180': isActive }">
                      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                  </div>
                </div>
              </button>

              <!-- Accordion Content -->
              <div
                class="accordion-content mt-4"
                x-show="isActive"
                x-transition:enter="transition ease-out duration-300"
                x-transition:enter-start="opacity-0 transform -translate-y-2"
                x-transition:enter-end="opacity-100 transform translate-y-0"
                x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 transform translate-y-0"
                x-transition:leave-end="opacity-0 transform -translate-y-2"
                id="accordion-content-{{ block.id }}"
                role="region"
                aria-labelledby="accordion-header-{{ block.id }}"
              >
                <div class="accordion-content-inner p-4 md:p-6 bg-gray-50 rounded-lg">
                  {% if block.settings.content != blank %}
                    <div class="rte text-text-400">
                      {{ block.settings.content }}
                    </div>
                  {% endif %}
                  
                  {% if block.settings.button_label != blank and block.settings.button_link != blank %}
                    <div class="mt-4">
                      <a
                        href="{{ block.settings.button_link }}"
                        class="inline-flex items-center px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors duration-200"
                      >
                        {{ block.settings.button_label | escape }}
                      </a>
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
        {% endcase %}
      {% endfor %}
    </div>
  </div>
</section>

<style>
  .accordion-section {
    background-color: var(--color-background);
  }

  .accordion-container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .accordion-item {
    transition: all 0.3s ease;
  }

  .accordion-header {
    cursor: pointer;
  }

  .accordion-header-content {
    transition: all 0.3s ease;
  }

  .accordion-header:hover .accordion-header-content {
    transform: translateY(-2px);
  }

  .accordion-header.active .accordion-header-content {
    border-color: var(--color-primary-500, #F68E02);
    box-shadow: 0 4px 12px rgba(246, 142, 2, 0.15);
  }

  .accordion-title {
    color: var(--color-text-500, #090914);
  }

  .accordion-icon {
    color: var(--color-text-400, #667085);
  }

  /* Desktop: Horizontal Layout */
  @media (min-width: 768px) {
    .accordion-container {
      display: flex;
      gap: 1.5rem;
    }
    
    .accordion-item {
      flex: 1;
      min-height: 400px;
    }
    
    .accordion-header-content {
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .accordion-image {
      flex-shrink: 0;
    }
    
    .accordion-content {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      z-index: 10;
    }
    
    .accordion-item {
      position: relative;
    }
  }

  /* Mobile: Vertical Layout */
  @media (max-width: 767px) {
    .accordion-container {
      flex-direction: column;
    }
    
    .accordion-item {
      width: 100%;
    }
    
    .accordion-content {
      position: relative;
    }
    
    .accordion-image img {
      height: 200px;
    }
  }

  /* Content styling */
  .accordion-content-inner {
    background-color: var(--color-background-100, #F9FAFB);
  }

  .rte {
    font-family: Satoshi, sans-serif;
    font-size: 16px;
    line-height: 1.5;
    color: var(--color-text-400, #667085);
  }

  .rte p {
    margin-bottom: 1rem;
  }

  .rte p:last-child {
    margin-bottom: 0;
  }
</style>

<script>
  function AccordionGroup() {
    return {
      activeIndex: 0,
      
      toggleAccordion(index) {
        // Only allow one accordion to be open at a time
        if (this.activeIndex === index) {
          this.activeIndex = -1; // Close if clicking the same one
        } else {
          this.activeIndex = index; // Open the clicked one
        }
        
        // Update all accordion items
        this.updateAccordionStates();
      },
      
      updateAccordionStates() {
        // Update the isActive state for all accordion items
        const accordionItems = this.$el.querySelectorAll('.accordion-item');
        accordionItems.forEach((item, index) => {
          const isActive = index === this.activeIndex;
          item.__x.$data.isActive = isActive;
        });
      },
      
      init() {
        // Initialize the first accordion as active
        this.$nextTick(() => {
          this.updateAccordionStates();
        });
      }
    }
  }
</script>

{% schema %}
{
  "name": "Accordion",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Section Subheading",
      "info": "Optional subheading text below the main heading"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "checkbox",
      "id": "custom_color_scheme",
      "default": false,
      "label": "Enable custom color scheme"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "accordion_item",
      "name": "Accordion Item",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Accordion Title",
          "default": "Accordion Item Title"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Accordion Image"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Accordion Content",
          "default": "<p>Add your accordion content here. This can include text, links, and other rich content.</p>"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button Label",
          "info": "Optional button in the accordion content"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Accordion",
      "blocks": [
        {
          "type": "accordion_item",
          "settings": {
            "title": "First Accordion Item",
            "content": "<p>This is the content for the first accordion item. You can add detailed information here.</p>"
          }
        },
        {
          "type": "accordion_item",
          "settings": {
            "title": "Second Accordion Item",
            "content": "<p>This is the content for the second accordion item. Each accordion can have its own unique content.</p>"
          }
        },
        {
          "type": "accordion_item",
          "settings": {
            "title": "Third Accordion Item",
            "content": "<p>This is the content for the third accordion item. Perfect for organizing information in a clean, accessible way.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}
